"use strict";(self.webpackChunk_plone_volto=self.webpackChunk_plone_volto||[]).push([[4304],{"./src/components/manage/Controlpanels/UpgradeControlPanel.jsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var lodash_map__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/map.js"),lodash_map__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash_map__WEBPACK_IMPORTED_MODULE_0__),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),react_redux__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../../node_modules/.pnpm/react-redux@8.1.2_@types+react-dom@18.2.12_@types+react@18.2.27_react-dom@18.2.0_react@18.2.0__react@18.2.0_redux@4.2.1/node_modules/react-redux/es/index.js"),redux__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__("../../../node_modules/.pnpm/redux@4.2.1/node_modules/redux/es/redux.js"),react_router_dom__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("../../../node_modules/.pnpm/react-router-dom@5.2.0_react@18.2.0/node_modules/react-router-dom/esm/react-router-dom.js"),react_dom__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../../node_modules/.pnpm/react-dom@18.2.0_react@18.2.0/node_modules/react-dom/index.js"),semantic_ui_react__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("../../../node_modules/.pnpm/semantic-ui-react@2.1.5_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/semantic-ui-react/dist/es/collections/Message/Message.js"),semantic_ui_react__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("../../../node_modules/.pnpm/semantic-ui-react@2.1.5_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/semantic-ui-react/dist/es/elements/Container/Container.js"),semantic_ui_react__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("../../../node_modules/.pnpm/semantic-ui-react@2.1.5_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/semantic-ui-react/dist/es/elements/Segment/Segment.js"),semantic_ui_react__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("../../../node_modules/.pnpm/semantic-ui-react@2.1.5_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/semantic-ui-react/dist/es/collections/Table/Table.js"),semantic_ui_react__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("../../../node_modules/.pnpm/semantic-ui-react@2.1.5_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/semantic-ui-react/dist/es/collections/Form/Form.js"),semantic_ui_react__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("../../../node_modules/.pnpm/semantic-ui-react@2.1.5_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/semantic-ui-react/dist/es/elements/Button/Button.js"),react_intl__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("../../../node_modules/.pnpm/react-intl@3.12.1_react@18.2.0/node_modules/react-intl/lib/index.js"),react_intl__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("../../../node_modules/.pnpm/react-intl@3.12.1_react@18.2.0/node_modules/react-intl/lib/components/message.js"),react_intl__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__("../../../node_modules/.pnpm/react-intl@3.12.1_react@18.2.0/node_modules/react-intl/lib/components/injectIntl.js"),_plone_volto_actions__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./src/actions/index.js"),_plone_volto_helpers__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./src/helpers/index.js"),_plone_volto_components__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./src/components/index.js"),_plone_volto_components_manage_Controlpanels__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./src/components/manage/Controlpanels/index.tsx"),_plone_volto_icons_back_svg__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./src/icons/back.svg"),_plone_volto_icons_back_svg__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(_plone_volto_icons_back_svg__WEBPACK_IMPORTED_MODULE_8__),react_toastify__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("../../../node_modules/.pnpm/react-toastify@5.5.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/react-toastify/esm/react-toastify.js"),__jsx=react__WEBPACK_IMPORTED_MODULE_1__.createElement;const messages=(0,react_intl__WEBPACK_IMPORTED_MODULE_9__.defineMessages)({back:{id:"Back",defaultMessage:"Back"},upgradeInformation:{id:"Upgrade Plone Site",defaultMessage:"Upgrade Plone Site"},upgrade:{id:"Upgrade Plone Site",defaultMessage:"Upgrade Plone Site"},upgradeSuccess:{id:"Your site is up to date.",defaultMessage:"Your site is up to date."},dryRunSuccess:{id:"Dry run selected, transaction aborted.",defaultMessage:"Dry run selected, transaction aborted."},upgradeError:{id:"There was an error with the upgrade.",defaultMessage:"There was an error with the upgrade."}}),UpgradeStep=({title:title,steps:steps})=>{const stepTitles=steps.map((step=>step.title));return __jsx(semantic_ui_react__WEBPACK_IMPORTED_MODULE_10__.c,null,__jsx(semantic_ui_react__WEBPACK_IMPORTED_MODULE_10__.c.Header,null,title),__jsx(semantic_ui_react__WEBPACK_IMPORTED_MODULE_10__.c.List,{items:stepTitles}))};class UpgradeControlPanel extends react__WEBPACK_IMPORTED_MODULE_1__.Component{constructor(props){super(props),this.runUpgrade=this.runUpgrade.bind(this),this.state={isClient:!1,dryRun:!1}}componentDidMount(){this.props.getUpgradeInformation(),this.props.getSystemInformation(),this.setState({isClient:!0,dryRun:!1})}runUpgrade(dryRun){this.props.runUpgrade(dryRun).then((()=>{dryRun?react_toastify__WEBPACK_IMPORTED_MODULE_11__.toast.success(__jsx(_plone_volto_components__WEBPACK_IMPORTED_MODULE_6__.qAm,{success:!0,title:this.props.intl.formatMessage(messages.upgrade),content:this.props.intl.formatMessage(messages.dryRunSuccess)})):(this.props.getUpgradeInformation(),react_toastify__WEBPACK_IMPORTED_MODULE_11__.toast.success(__jsx(_plone_volto_components__WEBPACK_IMPORTED_MODULE_6__.qAm,{success:!0,title:this.props.intl.formatMessage(messages.upgrade),content:this.props.intl.formatMessage(messages.upgradeSuccess)})))})).catch((()=>{react_toastify__WEBPACK_IMPORTED_MODULE_11__.toast.error(__jsx(_plone_volto_components__WEBPACK_IMPORTED_MODULE_6__.qAm,{error:!0,title:this.props.intl.formatMessage(messages.upgrade),content:this.props.intl.formatMessage(messages.upgradeError)}))}))}render(){const upgradeInformation=this.props.upgradeInformation,upgradeSteps=upgradeInformation?Object.entries(upgradeInformation.upgrade_steps):null;return upgradeInformation?__jsx(semantic_ui_react__WEBPACK_IMPORTED_MODULE_12__.c,{id:"upgrade-page",className:"controlpanel-upgrade"},__jsx(_plone_volto_helpers__WEBPACK_IMPORTED_MODULE_5__.So,{title:this.props.intl.formatMessage(messages.upgradeInformation)}),__jsx(semantic_ui_react__WEBPACK_IMPORTED_MODULE_13__.c.Group,{raised:!0},__jsx(semantic_ui_react__WEBPACK_IMPORTED_MODULE_13__.c,{className:"primary"},__jsx(react_intl__WEBPACK_IMPORTED_MODULE_14__.c,{id:"Upgrade Plone Site",defaultMessage:"Upgrade Plone Site"})),__jsx(semantic_ui_react__WEBPACK_IMPORTED_MODULE_13__.c,{className:"secondary"},__jsx(react_intl__WEBPACK_IMPORTED_MODULE_14__.c,{id:"More information about the upgrade procedure can be found in the documentation section of plone.org in the Upgrade Guide.",defaultMessage:"More information about the upgrade procedure can be found in the documentation section of plone.org in the Upgrade Guide."})),__jsx(semantic_ui_react__WEBPACK_IMPORTED_MODULE_10__.c,{attached:!0},__jsx(semantic_ui_react__WEBPACK_IMPORTED_MODULE_10__.c.Header,null,__jsx(react_intl__WEBPACK_IMPORTED_MODULE_14__.c,{id:"Configuration Versions",defaultMessage:"Configuration Versions"}))),__jsx(semantic_ui_react__WEBPACK_IMPORTED_MODULE_13__.c,null,upgradeInformation.versions.fs===upgradeInformation.versions.instance?__jsx(semantic_ui_react__WEBPACK_IMPORTED_MODULE_10__.c,{attached:!0,success:!0},__jsx(react_intl__WEBPACK_IMPORTED_MODULE_14__.c,{id:"Your site is up to date.",defaultMessage:"Your site is up to date."})):__jsx(semantic_ui_react__WEBPACK_IMPORTED_MODULE_10__.c,{attached:!0,warning:!0},__jsx(react_intl__WEBPACK_IMPORTED_MODULE_14__.c,{id:"The site configuration is outdated and needs to be upgraded.",defaultMessage:"The site configuration is outdated and needs to be upgraded."})),__jsx(semantic_ui_react__WEBPACK_IMPORTED_MODULE_15__.c,{celled:!0,padded:!0,columns:"2"},__jsx(semantic_ui_react__WEBPACK_IMPORTED_MODULE_15__.c.Body,null,__jsx(semantic_ui_react__WEBPACK_IMPORTED_MODULE_15__.c.Row,null,__jsx(semantic_ui_react__WEBPACK_IMPORTED_MODULE_15__.c.Cell,null,__jsx(react_intl__WEBPACK_IMPORTED_MODULE_14__.c,{id:"Current active configuration",defaultMessage:"Current active configuration"})),__jsx(semantic_ui_react__WEBPACK_IMPORTED_MODULE_15__.c.Cell,null,upgradeInformation.versions.instance)),__jsx(semantic_ui_react__WEBPACK_IMPORTED_MODULE_15__.c.Row,null,__jsx(semantic_ui_react__WEBPACK_IMPORTED_MODULE_15__.c.Cell,null,__jsx(react_intl__WEBPACK_IMPORTED_MODULE_14__.c,{id:"Latest available configuration",defaultMessage:"Latest available configuration"})),__jsx(semantic_ui_react__WEBPACK_IMPORTED_MODULE_15__.c.Cell,null,upgradeInformation.versions.fs))))),upgradeSteps.length>0&&__jsx(react__WEBPACK_IMPORTED_MODULE_1__.Fragment,null,__jsx(semantic_ui_react__WEBPACK_IMPORTED_MODULE_10__.c,{attached:!0},__jsx(semantic_ui_react__WEBPACK_IMPORTED_MODULE_10__.c.Header,null,__jsx(react_intl__WEBPACK_IMPORTED_MODULE_14__.c,{id:"Upgrade Steps",defaultMessage:"Upgrade Steps"})),__jsx(semantic_ui_react__WEBPACK_IMPORTED_MODULE_10__.c.Content,null,__jsx(react_intl__WEBPACK_IMPORTED_MODULE_14__.c,{id:"The following list shows which upgrade steps are going to be run. Upgrading sometimes performs a catalog/security update, which may take a long time on large sites. Be patient.",defaultMessage:"The following list shows which upgrade steps are going to be run. Upgrading sometimes performs a catalog/security update, which may take a long time on large sites. Be patient."}))),__jsx(semantic_ui_react__WEBPACK_IMPORTED_MODULE_13__.c,null,__jsx(semantic_ui_react__WEBPACK_IMPORTED_MODULE_12__.c,null,lodash_map__WEBPACK_IMPORTED_MODULE_0___default()(upgradeSteps,(upgradeGroup=>[__jsx(UpgradeStep,{key:upgradeGroup[0],title:upgradeGroup[0],steps:upgradeGroup[1]})]))),__jsx(semantic_ui_react__WEBPACK_IMPORTED_MODULE_10__.c,{negative:!0},__jsx(react_intl__WEBPACK_IMPORTED_MODULE_14__.c,{id:"Please ensure you have a backup of your site before performing the upgrade.",defaultMessage:"Please ensure you have a backup of your site before performing the upgrade."})),__jsx(semantic_ui_react__WEBPACK_IMPORTED_MODULE_16__.c.Checkbox,{onChange:(e,data)=>this.setState({dryRun:data.checked}),checked:this.state.dryRun,label:"Dry run mode"}),__jsx("br",null),__jsx(semantic_ui_react__WEBPACK_IMPORTED_MODULE_17__.c,{"aria-label":this.props.intl.formatMessage({id:"Upgrade",defaultMessage:"Upgrade"}),onClick:()=>this.runUpgrade(this.state.dryRun),primary:!0},__jsx(react_intl__WEBPACK_IMPORTED_MODULE_14__.c,{id:"Upgrade",defaultMessage:"Upgrade"})))),this.props.upgradeReport?__jsx(react__WEBPACK_IMPORTED_MODULE_1__.Fragment,null,__jsx(semantic_ui_react__WEBPACK_IMPORTED_MODULE_10__.c,{attached:!0},__jsx(semantic_ui_react__WEBPACK_IMPORTED_MODULE_10__.c.Header,null,__jsx(react_intl__WEBPACK_IMPORTED_MODULE_14__.c,{id:"Upgrade Report",defaultMessage:"Upgrade Report"}))),__jsx(semantic_ui_react__WEBPACK_IMPORTED_MODULE_13__.c,null,__jsx("pre",null,this.props.upgradeReport.report))):null,__jsx(semantic_ui_react__WEBPACK_IMPORTED_MODULE_10__.c,{attached:!0},__jsx(semantic_ui_react__WEBPACK_IMPORTED_MODULE_10__.c.Header,null,__jsx(react_intl__WEBPACK_IMPORTED_MODULE_14__.c,{id:"Version Overview",defaultMessage:"Version Overview"}))),__jsx(semantic_ui_react__WEBPACK_IMPORTED_MODULE_13__.c,null,this.props.systemInformation?__jsx(_plone_volto_components_manage_Controlpanels__WEBPACK_IMPORTED_MODULE_7__.yC,this.props.systemInformation):null)),this.state.isClient&&(0,react_dom__WEBPACK_IMPORTED_MODULE_3__.createPortal)(__jsx(_plone_volto_components__WEBPACK_IMPORTED_MODULE_6__.YT3,{pathname:this.props.pathname,hideDefaultViewButtons:!0,inner:__jsx(react__WEBPACK_IMPORTED_MODULE_1__.Fragment,null,__jsx(react_router_dom__WEBPACK_IMPORTED_MODULE_18__.cH,{to:"/controlpanel",className:"item"},__jsx(_plone_volto_components__WEBPACK_IMPORTED_MODULE_6__.GWx,{name:_plone_volto_icons_back_svg__WEBPACK_IMPORTED_MODULE_8___default(),"aria-label":this.props.intl.formatMessage(messages.back),className:"contents circled",size:"30px",title:this.props.intl.formatMessage(messages.back)})))}),document.getElementById("toolbar"))):null}}__webpack_exports__.default=(0,redux__WEBPACK_IMPORTED_MODULE_19__.compose)(react_intl__WEBPACK_IMPORTED_MODULE_20__.cp,(0,react_redux__WEBPACK_IMPORTED_MODULE_2__.connect)(((state,props)=>({upgradeInformation:state.upgrade.upgradeinformation,pathname:props.location.pathname,systemInformation:state.controlpanels.systeminformation,upgradeReport:state.upgrade.upgradereport})),{getUpgradeInformation:_plone_volto_actions__WEBPACK_IMPORTED_MODULE_4__.Sc,getSystemInformation:_plone_volto_actions__WEBPACK_IMPORTED_MODULE_4__._d,runUpgrade:_plone_volto_actions__WEBPACK_IMPORTED_MODULE_4__.aw}))(UpgradeControlPanel),UpgradeControlPanel.__docgenInfo={description:"UpgradeControlPanel class.\n@class UpgradeControlPanel\n@extends Component",methods:[{name:"runUpgrade",docblock:"Run Upgrade handler\n@method runUpgrade\n@param {boolean} dryRun Id of package to install.\n@returns {undefined}",modifiers:[],params:[{name:"dryRun",description:"Id of package to install.",type:{name:"boolean"},optional:!1}],returns:{},description:"Run Upgrade handler"}],displayName:"UpgradeControlPanel",props:{getUpgradeInformation:{description:"",type:{name:"func"},required:!0},getSystemInformation:{description:"",type:{name:"func"},required:!0},runUpgrade:{description:"",type:{name:"func"},required:!0}}}}}]);